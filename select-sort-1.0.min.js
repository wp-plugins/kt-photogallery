/* SelectSort v1.0 | (c) 2014 Daniel Schneider | GPLv 2 or later */
window.SelectSort=function(e){var t=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},s=function(e,t,s){var o=parseInt(e);return s?Math.max(t,Math.min(isNaN(o)?t:o,s)):Math.max(t,isNaN(o)?t:o)},o=function(n,i){var r=e(document),a=e("body"),l=e.extend({},o.defaults,i);l.distance=s(l.distance,0),l.offsetX=s(l.offsetX,0),l.offsetY=s(l.offsetY,0),e(n).each(function(){var s,o,n,i,f,c,u,d,h,g,m,p,v,y,w,C,x,M,X,b=this,K=e(this),Y=!0,D=function(e){if(e.ctrlKey||e.metaKey)s.toggleClass(l.selected);else if(e.shiftKey&&c){var t=s.index(),n=Math.min(t,c),i=Math.max(t,c)+1;K.children(l.filter).removeClass(l.selected).slice(n,i).addClass(l.selected),s=o}else s.addClass(l.selected).siblings(l.filter).removeClass(l.selected);var r=K.children(l.filter).filter("."+l.selected),a=r.length>0;Y&&(a?(Y=!1,K.on("mousedown",k)):K.off("mousedown",k)),o=s,c=s.index(),a?K.trigger("select",[r,X]):K.trigger("deselect")},k=function(e){e.target==b&&-!(e.metaKey||e.ctrlKey||e.shiftKey)&&(K.children(l.filter).removeClass(l.selected),Y=!0,K.off("mousedown",k),K.trigger("deselect"))},S=function(s){s.preventDefault(),(0==l.distance||t(s.pageX-h,s.pageY-p)>l.distance)&&(u=K.offset(),h-=u.left,p-=u.top,g=parseInt(K.css("paddingLeft")),v=parseInt(K.css("paddingTop")),X=K.children(l.filter).map(function(){var t=e(this),s=t.position();return{$:t,x:s.left+g,y:s.top+v,w:t.outerWidth(),h:t.outerHeight(),s:t.hasClass(l.selected)}}).get(),w=K.innerWidth(),x=K.innerHeight(),M=X.length,i=e('<div class="'+l.marquee+'"></div>').hide().appendTo(K),a.addClass(l.selecting),r.off("mousemove",S).off("mouseup",E),r.on("mousemove",$),r.one("mouseup",N).on("keydown",q),Y&&(Y=!1,K.on("mousedown",k)),K.trigger("selectStart",[X]))},$=function(t){t.preventDefault(),g=Math.max(0,Math.min(t.pageX-u.left,w)),v=Math.max(0,Math.min(t.pageY-u.top,x)),y=Math.abs(h-g),C=Math.abs(p-v),d=Math.min(h,g),m=Math.min(p,v),i.css({left:d,top:m,width:y+"px",height:C+"px",display:"block"});var s=t.ctrlKey||t.metaKey||t.shiftKey,o=e();e.each(X,function(e,t){t.$.toggleClass(l.selected,t.s),t.x+t.w<d||d+y<t.x||t.y+t.h<m||m+C<t.y||o.push(t.$.toggleClass(l.selected,!(s&&t.s))[0])}),o.length&&K.trigger("selectUpdate",[o,X])},q=function(t){t.preventDefault(),27==t.which&&(e.each(X,function(){this.$.toggleClass(l.selected,this.s)}),N(!1))},E=function(){r.off("mousemove",S)},N=function(e){if(i.remove(),r.off("mousemove",$).off("mouseup",N).off("keydown",q),a.removeClass(l.selecting),e){var t=K.children(l.filter).filter("."+l.selected);t.length?K.trigger("select",[t,X]):K.trigger("deselect")}K.trigger("selectEnd",[X])},U=function(s){s.preventDefault(),(0==l.distance||t(s.pageX-h,s.pageY-p)>l.distance)&&(u=K.offset(),X=K.children(l.filter).map(function(){var t=e(this);return{$:t,x:t.offset().left,w:t.outerWidth()/2}}).get(),n.addClass(l.sorting),a.addClass(l.sorting),r.off("mousemove",U).off("mouseup",I).off("mouseup",D),r.one("mouseup",j).on("keydown",H),K.on("mousemove",l.filter,T),l.helper&&(f=e("function"==typeof l.helper?l.helper.call(b,s,n,X):l.helper).hide().appendTo(K),f.hide(),r.on("mousemove",W)),K.trigger("sortStart",[n,X]))},I=function(){r.off("mousemove",U)},T=function(t){t.preventDefault();var s=e(this);if(!s.hasClass(l.sorting)){var o=s.index();s[t.pageX-X[o].x<X[o].w?"before":"after"](n),K.trigger("sortUpdate",[s,n,X])}},W=function(e){e.preventDefault(),f.css({left:e.pageX+l.offsetX-u.left,top:e.pageY+l.offsetY-u.top,display:"block"})},H=function(e){e.preventDefault(),27==e.which&&j(!1)},j=function(t){n.removeClass(l.sorting);var s=!1;e.each(X,function(e){return e!==this.$.index()?(s=!0,!1):void 0}),K.off("mousemove",l.filter,T),r.off("keydown",H),a.removeClass(l.sorting),l.helper&&(f.remove(),r.off("mousemove",W)),t&&s&&K.trigger("sort",[n,X]),K.trigger("sortEnd")},L=function(t){t.preventDefault();var o=K.children(l.filter).length;h=t.pageX,p=t.pageY,t.target==b?o&&(r.on("mousemove",S),r.one("mouseup",E)):(s=e(t.target).closest(l.filter),s.hasClass(l.selected)?r.one("mouseup",D):D(t),l.sortable&&o>1&&(n=K.children(l.filter).filter("."+l.selected),r.on("mousemove",U).one("mouseup",I)))};K.on("mousedown",L),e.each(["select","deselect","sort","selectStart","selectUpdate","selectEnd","sortStart","sortUpdate","sortEnd"],function(){var e=this+"";"function"==typeof l[e]&&K.on(e,l[e])})})};return o.defaults={sortable:!0,distance:7,offsetX:12,offsetY:12,filter:"li",selected:"ui-selected",selecting:"ui-selecting",sorting:"ui-sorting",marquee:"ui-marquee",helper:!1},o}(jQuery);